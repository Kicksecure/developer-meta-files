#!/bin/bash

## Copyright (C) 2025 - 2025 ENCRYPTED SUPPORT LLC <adrelanos@whonix.org>
## See the file COPYING for copying conditions.

set -x
set -e

git_tag_nearest="$(git describe --always --abbrev=0)"

for repo in github-derivative-maker github-kicksecure github-whonix adrelanos  ; do
   if git remote get-url "$repo" &>/dev/null ; then
      if git rev-parse --verify bookworm &>/dev/null ; then
         git verify-commit bookworm
         git push "$repo" bookworm &
         pid_list+=" $!"
      fi
      if [ ! "$git_tag_nearest" = "" ]; then
         git verify-tag "$git_tag_nearest"
         git push "$repo" "$git_tag_nearest" &
         pid_list+=" $!"
      fi
   fi
done

wait -- $pid_list

true "$0: OK"
